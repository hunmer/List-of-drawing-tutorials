<!DOCTYPE html>
<html lang="zh">
    <head>
        <link href="font/icon.css" rel="stylesheet">
        <meta charset="utf-8">
        <link type="text/css" rel="stylesheet" href="css/materialize.css" media="screen,projection"/>
        <link type="text/css" rel="stylesheet" href="css/custom.css" media="screen,projection"/>
        <link rel="stylesheet" href="css/style.css">
        <link rel="stylesheet" type="text/css" href="css/basictable.css"/>
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
        <meta http-equiv="Content-Security-Policy" content="block-all-mixed-content">
        <!-- 强制移动设备以app模式打开页面(即在移动设备下全屏，仅支持部分浏览器) -->
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-touch-fullscreen" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <meta name="full-screen" content="yes">
        <!--UC强制全屏-->
        <meta name="browsermode" content="application">
        <!--UC应用模式-->
        <meta name="x5-fullscreen" content="true">
        <!--QQ强制全屏-->
        <meta name="x5-page-mode" content="app">
        <!--QQ应用模式-->
        <meta name="description" content="List of drawing tutorials"/>
        <link rel="shortcut icon" href="favicon.svg">
        <title>List of drawing tutorials</title>
        <script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=5f268ab8dc4b84001371c287&product=inline-share-buttons" async="async"></script>
    </head>
    <body>
        <div class="navbar-fixed">
            <nav class="nav-extended">
                <div class="nav-wrapper">
                    <!-- <a href="javascript:$('.sidenav').sidenav('open');" class="brand-logo logo" style="width: fit-content;">List of drawing tutorials(1380)</a> -->
                    <a href="javascript:void(0)" data-target="slide-out" class="sidenav-trigger" style="    display: unset !important;">
                        <i class="material-icons">menu</i>
                    </a>
                    <a href="javascript:void(0)" onclick="openSearch();" class="right mr">
                        <i class="material-icons">search</i>
                    </a>
                    <a href="javascript:void(0)" id='like_btn' onclick="likeSite();" class="right mr" style="display: flex; padding-left: 10px;">
                        <i class="material-icons">favorite</i>
                        <span style="color: white; margin-left: 2px;">0</span>
                    </a>
                </div>
                <div class="nav-content">
                    <ul class="tabs tabs-transparent">
                        <li class="tab">
                            <a class="active" href="#test1">List</a>
                        </li>
                        <li class="tab" onclick='initFavorite();'>
                            <a href="#test2">Favorite</a>
                        </li>
                    </ul>
                </div>
            </nav>
        </div>
        <!-- 搜索界面 -->
        <nav id='search' style="display: none;height: 58px;background-color: white;">
            <div class="nav-wrapper">
                <form style="margin-bottom: 0px !important;height: 8%" onsubmit="return false;">
                    <span id='search_res'></span>
                    <div class="input-field">
                        <input id="search" type="search" oninput='searchByKeyword();' required style="height: 58px;">
                        <label class="label-icon" for="search">
                            <i class="material-icons">search</i>
                        </label>
                        <i class="material-icons" onclick="closeSearch(true);">close</i>
                    </div>
                </form>
                <ul class="collection" style="margin-top: 60px !important;border: 0px !important;z-index: 33"></ul>
            </div>
        </nav>
        <!-- 侧边栏开始 -->
        <ul id="slide-out" class="sidenav">
            <li>

                <a href="javascript: $('.sidenav').sidenav('close');$('div[data-network=sharethis]').click();">
                    <i class="material-icons">share</i>
                    Share
                </a>
            </li>
            <li>
                <a target="_blank" href="https://github.com/hunmer/List-of-drawing-tutorials">
                    <i class="material-icons">code</i>
                    Code
                </a>
            </li>
            <li>
                <a href='javascript: openNews()'>
                    <i class="material-icons">fiber_new</i>
                    News
                </a>
            </li>
            <li>
                <a target="_blank" href="https://github.com/hunmer/List-of-drawing-tutorials/commits/master">
                    <i class="material-icons">description</i>
                    Logs
                </a>
            </li>
            <li>
                <a href="javascript: $('#modal3').html(`<div class='modal-content'><h3>!NOT OFFICAL!</h3><p>This discord is not the official website of<a href='https://yande.re'>yande.re</a>,But you can share your drawings here or you are interested in translating books and so on.</p></div><div class='modal-footer'><a href='https://discord.gg/MPdwzcq'class='modal-close waves-effect waves-red btn-flat'target='_blank'>Join</a><a href='javascript: void(0)'class='modal-close waves-effect waves-red btn-flat'>No,Thanks</a></div></div>`).modal('open');">
                    <i class="material-icons">toys</i>
                    discord
                </a>
            </li>
            
             <ul class="collapsible">
                <li>
                    <div class="collapsible-header">
                        <i class="material-icons">apps</i>
                        Tools
                    </div>
                    <div class="collapsible-body">
                        <a target="_blank" href="https://sites.google.com/site/shinchirosplayground/home/mega-link-downloader" style="text-align: center;" class='block'>MEGA Link Downloader</a>
                    </div>
                </li>
            </ul>
            <ul class="collapsible">
                <li>
                    <div class="collapsible-header">
                        <i class="material-icons">link</i>
                        Links
                    </div>
                    <div class="collapsible-body">
                        <a target="_blank" href="https://vk.com/topic-4918594_27696136?offset=0" style="text-align: center;" class='block'>Bykodorova Katerina(5700pdf+)</a>
                    </div>
                </li>
            </ul>
        </ul>
        <!-- 侧边栏结束 -->
        <!-- 自定义弹出 -->
        <div id="modal2" class="modal"></div>
        <div id="modal3" class="modal"></div>

        <div id="modal_comment" class="modal modal-fixed-footer"></div>
        <div class='_content' id="test1" class="col s12">
            <div class="preloader-wrapper big active">
                <div class="spinner-layer spinner-blue-only">
                    <div class="circle-clipper left">
                        <div class="circle"></div>
                    </div>
                    <div class="gap-patch">
                        <div class="circle"></div>
                    </div>
                    <div class="circle-clipper right">
                        <div class="circle"></div>
                    </div>
                </div>
            </div>
            <div id='_table_show'>
                <table id="table-two-axis" class="two-axis" style="display: none; margin-top: 50px;">
                    <thead>
                        <tr>
                            <th>Book</th>
                            <th></th>
                            <th>Lang</th>
                            <th>Size</th>
                            <th>Action</th>
                            <th>Backup</th>
                            <th>...</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class='_page' style="margin-top: 10px; height: 40px;"></div>
            <div class="sharethis-inline-share-buttons"></div>
        </div>
        <div class='_content' id="test2" class="col s12" style="display: none; margin-top: 50px;">
            <div class="fixed-action-btn" id='floating'>
    <a class="btn-floating btn-large red">
      <i class="large material-icons">menu</i>
    </a>
    <ul>
      <li><a class="btn-floating red"><i class="material-icons">file_download</i></a></li>
           
      <li><a class="btn-floating yellow darken-1"><i class="material-icons">file_upload</i> <input id="upload" class='inputstyle' type="file" accept=".json" onchange="uploadFile()"/></a></li>
      <li><a class="btn-floating green"><i class="material-icons">delete</i></a></li>
      <li><a class="btn-floating blue"><i class="material-icons">search</i></a></li>
    </ul>
  </div>
            <div class="row" style="margin: 3px;"></div>
        </div>
        <script src="js/jquery.min.js" type="text/javascript"></script>
        <script src="js/until.js" type="text/javascript"></script>
        <script type="text/javascript" src='js/clipboard.min.js'></script>
        <script type="text/javascript" src="js/lazyload.min.js"></script>
        <script type="text/javascript" src="js/jquery.basictable.js"></script>
        <script type="text/javascript" src="js/materialize.min.js"></script>
        <script>
            var g_load = 20;
            var g_s_search = '';
            var g_search = [];
            var g_datas = [];
            var a_get = getGETArray();
            var g_max = -1;
            var g_page = 0;
            var g_b_searchInFavorite = false;
            var g_max_page = 0;

            window.history.pushState(null, null, "#");
            window.addEventListener("popstate", function(event) {
                if ($('#test2').hasClass('active')) {
                    $('.tab a')[0].click()
                    window.history.pushState(null, null, "");
                    event.preventDefault(true);
                }else
                if(M.Modal.getInstance($('#modal2')).isOpen){
                   M.Modal.getInstance($('#modal2')).close();
                    event.preventDefault(true);
                }

            });

            function uploadFile(){
              var file = $('#upload')[0].files[0];
               var reader = new FileReader();
               reader.readAsText(file);
               reader.onload = function(e){
                try {
                  json = JSON.parse(this.result);
                  if(json.length > 0){
                    if(json.length < g_favorite.length){
                      if(!confirm('The imported data('+json.length+') is less than your current data('+json.length+'). Are you sure to import?')){
                        return;
                       
                      }
                    }
                     g_favorite = json;
                     local_saveJson('favorite', g_favorite);
                    initFavorite();
                    alert('Successfully imported '+json.length+' books');
                  }
                }
                catch(err){
                  alert('Corrupted data!');
                }
               }
            }

            function likeSite() {
                var isLike = parseInt(getLocalItem('isLiked', 0)) == 1;
                var likeCount = parseInt($('#like_btn span').html());
                if (isLike) {
                    likeCount--;
                    setLocalItem('isLiked', 0);
                } else {
                    likeCount++;
                    setLocalItem('isLiked', 1);
                }
                updateStatus();
                getLikeCount({
                    s: isLike ? '0' : '1'
                });
                setLikeCount(likeCount);
            }

            function getLikeCount(params={}) {
                //var api = './php/like.php';
                var api = 'https://neysummer2000-location.glitch.me/like.php';
                $.post(api, params, function(data, textStatus, xhr) {
                    if (textStatus == 'success') {
                        data = JSON.parse(data);
                        if (data != undefined) {
                            setLikeCount(data.count);
                            setLocalItem('likeCount', parseInt(data.count));
                            //setLocalItem('isLiked', parseInt(data.liked));
                            updateStatus();
                        }
                    }
                });
            }

            function getGETArray() {
                var a_result = [], a_exp;
                var a_params = window.location.search.slice(1).split('&');
                for (var k in a_params) {
                    a_exp = a_params[k].split('=');
                    if (a_exp.length > 1) {
                        a_result[a_exp[0]] = decodeURIComponent(a_exp[1]);
                    }
                }
                return a_result;
            }

            function openNews(){
              var html = '';
              var news = local_readJson('news');
                for(var img of news){
                  for(var i=0;i<g_datas.length;i++){
                    if(g_datas[i].img == img){
                      var page = parseInt(i / g_load) + 1;
                      html = html + getResultHtml(i, page, g_datas[i], g_datas[i].title);
                      break;
                    }
                  }
                }
                $('#modal2').html(`<div class="modal-content" id='newUpdaload'>
                        <h4>Recent Uploads(`+news.length+`)</h4>
                         <div class="row">
                              <form>
                                <div class="row">
                                <ul class="collection" style="margin-top: 60px !important;border: 0px !important;z-index: 33">`+html+`</ul>
                </div></form></div></div>`).modal('open');
                  $('.lazyload').lazyload();
            }
            var g_s_md5 = '90902fefee157d945d5fa216c4d16611';
            function initData(save=true) {
             if(localStorage.getItem('data-md5') != g_s_md5){
                  var news = [];
                  var old = JSON.parse(localStorage.getItem('data'));
                  if(old != null){
                    var old_imgs = [];
                    var new_imgs = [];
                    var html = '';
                    for(var d of old){
                      old_imgs.push(d.img);
                    }
                    for(var d of g_datas){
                      new_imgs.push(d.img);
                    }
                      for(var i=0;i<new_imgs.length;i++){
                        if(old_imgs.indexOf(new_imgs[i]) == -1){
                          news.push(g_datas[i].img);
                          //console.log('new ', g_datas[i].title);
                          var page = parseInt(i / g_load) + 1;
                          html = html + getResultHtml(i, page, g_datas[i], g_datas[i].title);
                        }
                      }
                      if(news.length > 0){
                         $('#modal2').html(`<div class="modal-content" id='newUpdaload'>
                              <h4>Recent Uploads(`+news.length+`)</h4>
                               <div class="row">
                                    <form>
                                      <div class="row">
                                      <ul class="collection" style="margin-top: 60px !important;border: 0px !important;z-index: 33">`+html+`</ul>
                      </div></form></div></div>`).modal('open');
                        $('.lazyload').lazyload();
                        local_saveJson('news', news);
                      }
                  }
              }
                var val = $('input#search').val();
                if (val == '') {
                    // 没有搜索,直接加载
                    loadPage(a_get['page'] != undefined ? a_get['page'] : 1, save);
                } else {
                    // 等待用户选择项目
                    $('._content').hide();
                    searchByKeyword();
                }

                if (save) {
                    localStorage.setItem('data-md5', g_s_md5);
                    localStorage.setItem('data', JSON.stringify(g_datas));
                }
            }

            if (a_get['lang'] == undefined) {
                a_get['lang'] = 'ALL';
            }
            $(function() {
                M.AutoInit();
                $('textarea').characterCounter();

                $('.fixed-action-btn').floatingActionButton({
                  hoverEnabled: false
                 });
                //initFavorite();
                if (a_get['s'] != undefined) {
                    $('input#search').val(a_get['s']);
                    a_get['s'] = '';
                    window.history.pushState(null, null, "");
                    openSearch(false);
                }

                if (false && localStorage.getItem('data-md5') == g_s_md5) {
                    g_datas = JSON.parse(localStorage.getItem('data'));
                    initData(false);
                } else if (window.location.protocol == 'file:') {
                    var D = document;
                    var scriptNode = D.createElement('script');
                    scriptNode.type = "text/javascript";
                    scriptNode.src = './js/drawbooks.js';
                    var targ = D.getElementsByTagName('head')[0] || D.body || D.documentElement;
                    targ.appendChild(scriptNode);
                    scriptNode.onload = function() {
                        initData();
                    }
                } else {
                    $.getJSON('./js/drawbooks.json', function(json, textStatus) {
                        g_datas = json;
                        initData();
                    });
                }


                $(document).on('click', '.bt-content i', function(event) {
                  //if(this.innerText == 'arrow_drop_down'){}
                  var key = $(this).parents('tr').attr('key');
                  var h = `<div class="modal-content" key='`+key+`'>
                       <ul class="collection">
                      <li class="collection-item" onclick='_dialog_shareBook(`+key+`)'><i class="material-icons right">content_copy</i>Share</li>
                      </ul>
                     <div class="modal-footer">
                      <a href="javascript: void(0)" class="modal-close waves-effect waves-red btn-flat">Cancel</a>
                      </div></div>`;
                  $('#modal2').html(h).modal('open');
                }).
                on('click', 'tr img', function() {
                    var d = $(this).parent().parent().parent().find('a.read');
                    if (d.length > 0)
                        d[0].click();
                }).on('click', '#search .collection-item, #newUpdaload .collection-item', function() {
                    closeSearch(false);
                    $('.sidenav').sidenav('close')
                    toItem($(this))
                    if(M.Modal.getInstance($('#modal2')).isOpen){
                       M.Modal.getInstance($('#modal2')).close();
                    }
                }).on('click', 'tr, .card', function() {
                    if ($(this).hasClass('search_active')) {
                        $(this).removeClass('search_active');
                    }

                }).on('click', '.star', function(event) {
                    favoriteByDom($(this).parent().parent().parent().attr('key'), $(this));
                    event.preventDefault();
                }).on('click', '.pagination li', function(event) {
                    var dom = $(this);
                    var d = dom.find('i');
                    if (d.length > 0) {
                        if (d[0].innerText == 'chevron_left') {
                            loadPage(g_page - 1);
                        } else {
                            loadPage(g_page + 1);
                        }
                    } else {
                        loadPage(dom.attr('index'));
                    }
                }).on('click', 'th, td:lt(5)', function() {
                    var type;
                    if (this.nodeName == 'TD') {
                        type = $(this).attr('data-th');
                    } else {
                        type = this.innerHTML;
                    }
                    switch (type) {
                    case 'Lang':
                        var h = `
                            <div class="modal-content">
                              <h4>Lang</h4>
                               <div class="row">
                                    <form>
                                      <div class="row">
                                      `;
                        var b;
                        for (var lang of ['ALL', 'ENGLISH', 'CHINESE', 'JAPANESE', 'KOREAN', 'OTHER', 'TEST']) {
                            b = lang == a_get['lang'];
                            h = h + `<p>
                                      <label>
                                        <input onclick="setLang('` + lang + `');" type="checkbox"` + (b ? ' checked="checked":' : '') + `/>
                                        <span>` + lang + `</span>
                                      </label>
                                    </p>`;
                        }
                        h = h + '</div></form></div></div>';
                        $('#modal2').html(h).modal('open');
                        break;
                    }
                })
                
                .on('click', '#floating li', function(){
                  switch($(this).find('i').html()){
                    case 'delete':
                      if(g_favorite.length > 0){
                         var h = `<div class="modal-content">
                              <h3>Reset the Favorite?</h3>
                              <p>Are you sure? It will clear your favorites!!!</p>
                             <div class="modal-footer">
                              <a href="javascript: void(0)" onclick="$('div .row ').html('');g_favorite = [];local_saveJson('favorite', []);$('.star').html('star_border');M.Modal.getInstance($('#modal2')).close();" class="waves-effect waves-green btn-flat" >Reset</a>
                              <a href="javascript: void(0)" class="modal-close waves-effect waves-red btn-flat">Cancel</a>
                              </div></div>`;
                          $('#modal2').html(h).modal('open');
                      }
                      break;

                      case 'file_download':
                        downloadData(g_favorite);
                        break;

                      case 'search':
                        g_b_searchInFavorite = true;
                        $('#search').attr('data-favorite', '1');
                        openSearch(true, true);
                        break;

                      break;

                  }
                });
                getLikeCount();
            });


                function copyBookInfo(index){
                  var d = g_datas[index];
                  var a = [];
                  $('#modal2 input:checked').each(function(index, el) {
                    var type = $(el).next().html();
                    switch(type){
                      case 'Title':
                        a.push('Book: '+d.title);
                        break;

                      case 'Lang':
                        a.push('Lang: '+d.lang);
                        break;

                      case 'FileSize':
                        a.push('Size: '+formatFileSize(d.online.size));
                        break;
                      case 'DirectLink':
                        a.push('Download As PDF: http://pan-yz.chaoxing.com/download/downloadfile?fleid=' + d.online.id + '&puid=142588570');
                        break;

                       case 'ReadOnline':
                        a.push('ReadOnline: https://neysummer2000-location.glitch.me/?id=' + d.online.id + '&title=' + encodeURI(d.title));
                        break;

                      default:
                        var i = parseInt(type.replace('Download Link ', ''));
                        if(i > 0){
                          a.push(type+' : '+d.link[i-1]);
                        }
                        break;
                    }
                  });

                  if(a.length>0){
                    a.push("------------------------\r\nGenerate from "+location.origin + location.pathname);
                    openCopyDialog(a.join("\r\n"), d.title);
                  }
                }

                  

                function openCopyDialog(content, title = ''){
                   var h = `<div class="modal-content">
                   <h3>`+title+`</h3>
                    <div class="input-field col s12">
                      <textarea id="textarea2" class="materialize-textarea" data-length="9999">`+content+`</textarea>
                    </div>
                  </div>
                   <div class="modal-footer">
                      <a href="javascript: void(0)" id='copy' class="modal-close waves-effect waves-red btn-flat" data-clipboard-target="#textarea2">Copy</a>
                      <a href="javascript: void(0)" class="modal-close waves-effect waves-red btn-flat">Cancel</a>
                      </div></div>`;
                  $('#modal3').html(h).modal('open');
                  M.textareaAutoResize($('#textarea2'));

                  if (g_clipboard != undefined) {
                      g_clipboard.destroy();
                  }
                  g_clipboard = new Clipboard('#copy');
                  g_clipboard.on('success', function(e) {
                      e.clearSelection();
                      alert('Copied!');
                  });
                  g_clipboard.on('error', function(e) {
                      alert($(e.trigger).attr('data-clipboard-text'));
                  });
                }

                function _dialog_shareBook(index){
                  var d = g_datas[index];
                    var h = `<div class="modal-content">
                        <form action="#">
                          <p>
                            <label>
                              <input type="checkbox" class="filled-in" checked="checked" />
                              <span>Title</span>
                            </label>
                          </p>
                         <p>
                            <label>
                              <input type="checkbox" class="filled-in" checked="checked" />
                              <span>Lang</span>
                            </label>
                          </p>`;
                  if(d.online != undefined){
                    h = h + `<p>
                            <label>
                              <input type="checkbox" class="filled-in" checked="checked" />
                              <span>FileSize</span>
                            </label>
                          </p>
                          <p>
                            <label>
                              <input type="checkbox" class="filled-in" checked="checked" />
                              <span>DirectLink</span>
                            </label>
                          </p>
                          <p>
                            <label>
                              <input type="checkbox" class="filled-in"/>
                              <span>ReadOnline</span>
                            </label>
                          </p>`;
                  }
                  h = h + '<p><div class="divider" style="margin: 10px;"></div></p>';
                  for(var i=0;i<d.link.length;i++){
                     h = h + `<p>
                            <label title="`+d.link[i]+`">
                              <input type="checkbox" class="filled-in"/>
                              <span>Download Link `+(i+1)+`</span>
                            </label>
                          </p>`;
                  }
                  h = h + `</form>
                     <div class="modal-footer">
                      <a href="javascript: copyBookInfo(`+index+`)" class="modal-close waves-effect waves-red btn-flat">Copy</a>
                      <a href="javascript: void(0)" class="modal-close waves-effect waves-red btn-flat">Cancel</a>
                      </div></div>`;
                  $('#modal2').html(h).modal('open');
                }

            function downloadData(d){
                var eleLink = document.createElement('a');
                eleLink.download = 'my_favorite_drawing_tutorials_list['+d.length+'].json';
                eleLink.style.display = 'none';
                var blob = new Blob([JSON.stringify(d)]);
                eleLink.href = URL.createObjectURL(blob);
                document.body.appendChild(eleLink);
                eleLink.click();
                document.body.removeChild(eleLink);
            }

            function openNew(url) {
                if (window.newW != undefined)
                    window.newW.close();
                window.newW = window.open(url, 'newwindow', 'height=1000, width=720, top=1000,left=100, toolbar=no, menubar=no, scrollbars=no, resizable=no,location=no,status=no');

            }

            function isFavorited(d) {
                for (var i = 0; i < g_favorite.length; i++) {
                    if (g_favorite[i].title == d.title && g_favorite[i].lang == d.lang) {
                        return i;
                    }
                }
                return -1;
            }

            function favoriteByDom(id, dom=null) {
                var d = g_datas[id];
                var key = isFavorited(d);

                if (key != -1) {
                    g_favorite.splice(key, 1);
                    dom.html('star_border');
                } else {
                    g_favorite.push(g_datas[id]);
                    dom.html('star');
                }
                local_saveJson('favorite', g_favorite);
            }

            function initPage(page) {
                var start, end, b_end;
                if (page == g_max_page) {
                    start = g_max_page - 4;
                    if (start <= 0) start = 1;
                    end = g_max_page;
                    b_end = true;
                } else {
                    start = page - 2;
                    if (start <= 0) start = 1;
                    end = start + 5;
                    if (end > g_max_page) {
                        b_end = true;
                        end = g_max_page;
                    }
                }
                var html = '';
                for (var i = start; i <= end; i++) {
                    html = html + `<li index='` + i + `' class="` + (i == page ? 'active' : 'waves-effect') + `"><a href="#!">` + i + `</a></li>`;
                }
                if (!b_end) {
                    if (g_max_page > 5) {
                        html = html + `<li index='-1' class='waves-effect'><a class='modal-trigger' href="javascript: pageSelecter();">...</a></li><li index='` + g_max_page + `' class="waves-effect"><a href="#!">` + g_max_page + `</a></li>`;
                    }
                }
                 if(start > 1){ // 第一页显示
                 html = `<li index=1 class="waves-effect"><a href="#!">1</a></li><li index='-1' class='waves-effect'><a class='modal-trigger' href="javascript: pageSelecter();">...</a></li>` + html;
                }
                html = `<ul class="pagination center" style="height: 100px;">
                  <li class="` + (page == 1 ? 'disabled' : 'waves-effect') + `"><a href="#!"><i class="material-icons">chevron_left</i></a></li>` + html + `<li class="` + (b_end ? 'disabled' : 'waves-effect') + `"><a href="#!"><i class="material-icons">chevron_right</i></a></li>
             </ul>`;
                $('._page').html(html);
            }

            function pageSelecter() {
                var h = `<div class="modal-content">
                        <h4 style='text-align: center;'>Choose Page</h4>
                          <div class="row">
                          <a href='javascript: pageAdd(-1);' class="waves-effect waves-light btn col s3" style='margin-top: 13px;'><i class="material-icons left">navigate_before</i></a>
                    <div class="input-field col s6">
                      <input style='text-align: center;' value="` + g_page + `" id="page_input" type="number" class="validate">
                      <label class="active" style='text-align: center;'>Page(1 - ` + (parseInt(g_max / g_load) + 1) + `)</label>
                    </div>
                <a href='javascript: pageAdd(1);' class="waves-effect waves-light btn col s3" style='margin-top: 13px;'><i class="material-icons right">navigate_next</i></a>

                  </div>
                  <div class="modal-footer">
                      <a href="javascript: void(0)" onclick='toPage();' class="waves-effect waves-green btn-flat" >Go</a>
                      <a href="javascript: void(0)" class="modal-close waves-effect waves-red btn-flat">Cancel</a>
                      </div></div>`;
                $('#modal2').html(h).modal('open');
                $('#page_input').keydown(function(event) {
                    if (event.which == 13) {
                        toPage();
                    }
                });
            }

            function pageAdd(add) {
                var page = parseInt($('#page_input').val()) + add;
                if (page > g_max_page) {
                    page = g_max_page;
                } else if (page <= 0) {
                    page = 1;
                }
                $('#page_input').val(page);
            }

            function toPage() {
                var page = parseInt($('#page_input').val());
                if (page > g_max_page) {
                    //$('#modal2 h4').html('error page number!');
                    $('#modal2 input').addClass('input_error');
                } else {
                    loadPage(page);
                    M.Modal.getInstance($('#modal2')).close();
                }
            }

             var g_list = [];
             var g_keys = [];
            function loadPage(page, savemd5=false) {
                if(g_list.length === 0){
                  g_max = 0;
                  var l;
                  var lang = a_get['lang'].toLocaleLowerCase();
                  // test
                  if(lang == 'test'){
                    for(var i=0;i<g_datas.length;i++){
                        if(g_datas[i].online == undefined){
                            if(g_datas[i].link.length > 0){
                                g_list.push(g_datas[i]);
                                g_keys.push(i);
                            }else{
                                console.log(g_datas[i]);
                            }
                        }
                    }
                  }else{
                    var langs = ['english', 'chinese', 'japanese', 'korean'];
                    if(lang != 'all'){
                      for(var i=0;i<g_datas.length;i++){
                        l = g_datas[i].lang.toLocaleLowerCase();
                        if(lang == 'other'){
                          if(langs.indexOf(l) !== -1) continue;
                        }else{
                          if(l != lang) continue;
                        }
                           g_list.push(g_datas[i]);
                           g_keys.push(i);
                      }
                    }else{
                      g_list = g_datas;
                    }
                  }
                  g_max = g_list.length;
                }

                var id = 0;
                g_max_page = Math.round(g_max / g_load);
                if(g_max_page <= 0) g_max_page = 1;
                if (page > 0 && page <= g_max_page) {
                    toTop();

                    var d;
                    var start, end;
                    start = (page - 1) * g_load;
                    if (start < 0) start = 0;
                    end = start + g_load;
                    if (end > g_max) end = g_max - 1;
                    
                    var h = `
              <div class='_page' style="margin-top: 55px; height: 40px;"></div>
              <table id="table-two-axis" class="two-axis" style="display: none; margin-top: -5px;">
                <thead>
                  <tr>
                    <th style='width: 100px; !important'>Book</th>
                    <th></th>
                    <th>Lang</th>
                    <th>Size</th>
                    <th>Action</th>
                    <th>Backup</th>
                    <th>...</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td></td>
                    <td></td>
                    <td>
                        <select id='#lang_select'>
                          <option value="" disabled selected>ALL</option>
                          <option value="1">ENGLISH</option>
                          <option value="2">JAPANESE</option>
                          <option value="3">CHINESE</option>
                          <option value="4">KOREAN</option>
                          <option value="3">OTHER</option>
                        </select>
                    </td>
                    <td></td>
                    <td></td>
                    <td></td>
                  </tr>`;

                  var key;
                    for (var id = start; id < end; id++) {
                        d = g_list[id];

                        // 数据里的主键
                        if(id < g_keys.length){
                          key = g_keys[id];
                        }else{
                          key = id;
                        }

                        h = h + `<tr key=` + key + `><td>` + 
                        (d.online != undefined ? ` <i data-index=` + id + ` class="material-icons right star">` + (isFavorited(d) == -1 ? 'star_border' : 'star') + `</i>` : '') + `
                  <span class='_id'>` + (id + 1) + `</span><img data-src="` + d.img + `" class='lazyload'></td>
                  <td><a target="_blank" href="https://www.google.com/search?q=` + d.title + `">` + d.title + `</a></td>
                  
                  <td>` + d.lang + `</td>`;

                        if (d.online != undefined) {
                            h = h + `<td>` + formatFileSize(d.online.size) + `</td>`;
                            h = h + `<td class='_action'><a class='read' href="javascript:openNew('https://neysummer2000-location.glitch.me/?id=` + d.online.id + `&title=` + encodeURI(d.title) + `')">readOnline</a>&nbsp;&nbsp;&nbsp;<a class='copy_btn' href="javascript: openCopyDialog('http://pan-yz.chaoxing.com/download/downloadfile?fleid=` + d.online.id + `&puid=142588570', '`+d.title+`');">directDownload</a></td>`;
                        } else {
                            h = h + `<td></td><td></td>`;
                        }

                        h = h + '<td>';
                        for (var i = 0; i < d.link.length; i++) {
                           var url = d.link[i];
                          if(url.indexOf('vk.com/') != -1){
                            if(url.indexOf('&dl=') == -1 && d.page != undefined){
                              url = 'https://neysummer2000-location.glitch.me/getVKURL.php?doc='+getString(url, 'vk.com/doc', '?')+'&page='+d.page;
                            }
                            h = h + `<a href="javascript:openNew('` + url + `')">` + (i + 1) + '.download</a>';
                          }else
                          if (url.indexOf('提取码') === -1) {
                                h = h + '<a target="_blank" href="' + url + '">' + (i + 1) + '.download</a>';
                            }else{
                                h = h + url;
                            }
                            h = h + '&nbsp;&nbsp;';
                        }

                        h = h + '</td><td><i class="material-icons">arrow_drop_down</i></td></tr>';
                    }
                    h = h + '</tbody></table>'
                    $('.preloader-wrapper').hide();
                    $('select').val(a_get['lang']);
                    $('#_table_show').html(h);
                    $(".lazyload").lazyload({
                        effect: "fadeIn"
                    });
                    $('#table-two-axis').show().basictable();
                    // 为可以预览的文件加上鼠标手势
                    $('td._action').parent().find('img').css('cursor', 'pointer');
                    $('td:eq(2)').css({
                      'font-size': '20px',
                      'cursor': 'pointer'
                    }).html(a_get['lang']);
                    initPage(page);
                }
            }

            var g_clipboard;

            function formatFileSize(fileSize) {
                if (fileSize < 1024) {
                    return fileSize + 'B';
                } else if (fileSize < (1024 * 1024)) {
                    var temp = fileSize / 1024;
                    temp = temp.toFixed(2);
                    return temp + 'KB';
                } else if (fileSize < (1024 * 1024 * 1024)) {
                    var temp = fileSize / (1024 * 1024);
                    temp = temp.toFixed(2);
                    return temp + 'MB';
                } else {
                    var temp = fileSize / (1024 * 1024 * 1024);
                    temp = temp.toFixed(2);
                    return temp + 'GB';
                }
            }

            function setLang(lang) {
                window.location.href = './index.html?lang=' + lang;
            }

            function openSearch(hide=true, clear = false) {
              if(clear){
                 $('#search .collection').html('');
                 $('#search_res').html('');
                 $('#search input').val('');
              }
                $('.navbar-fixed').hide();
                $('#search').show();
                if (hide) {
                    hideContent();
                }
                $(document).scrollTop(0);
                // setTimeout(function() {
                // //$('#search input').focus(); // 移动端弹出输入法会造成文档改变大小从而导致卡顿
                // }, 1000);
            }

            function hideContent() {
                $('._content.active').hide();
            }

            function showContent() {
                $('._content.active').show();
            }

            function closeSearch(reset=true) {
                if($('#search').attr('data-favorite') != undefined){
                  $('#search').attr('data-favorite', null)
                  $('#search .collection').html('');
                  $('#search_res').html('');
                  $('#search input').val('');
                }
                $('.navbar-fixed').show();
                $('#search').hide();
                if (reset) {
                    $('input#search').val('');
                    $('#search .collection').html('');
                    $('#search_res').html('');
                }
                showContent();
                if(g_page == 0){
                  loadPage(1, getLocalItem('data-md5') != g_s_md5);
                }
            }

            function toTop() {
                $('html,body').animate({
                    scrollTop: 0
                }, 500);
            }

            function toPageEnd() {
                $('html,body').animate({
                    scrollTop: $(this).height()
                }, 500);
            }

            function searchByKeyword() {
                var s = $('#search input').val().toLocaleLowerCase();
                var html = '';
                var page;
                var c = 0;
                var datas;
                var k;
                var json;

                var b_isFitler = g_keys.length > 0;
                if (s != '') {
                  if(g_b_searchInFavorite){
                    datas = g_favorite;
                  }else{
                    datas =  b_isFitler ? g_list : g_datas; // 语言筛选
                  }
                    
                    for (var i=0; i<datas.length;i++) {
                        json = datas[i];
                        page = parseInt(i / g_load) + 1;
                        k = b_isFitler && !g_b_searchInFavorite ? g_keys[i] : i;
                        var i_s = json.title.toLocaleLowerCase().indexOf(s);
                        if (i_s !== -1) {
                            c++;
                            html = html + getResultHtml(k, page, json, json.title.toLocaleLowerCase().replace(s, '<span style="color: red">' + s + '</span>'));
                        }
                        k++;
                    }
                }
                if (c == 0) {
                    html = html + '<h1 style="display: block; text-align: center">Nothing Found...</h1>';
                }
                $('#search_res').html(c + ' results');
                $('#search .collection').html(html);
                $(".lazyload").lazyload({
                    effect: "fadeIn"
                });
            }

            function getColorByLang(lang) {
                if (lang == 'JAPANESE') {
                    return 'green';
                } else if (lang == 'CHINESE') {
                    return 'red';
                } else {
                    return 'blue';
                }
            }

            function getResultHtml(k, page, json, title){
              return `<li class="collection-item avatar z-depth-2 waves-effect block" style='width: 100%;color: black;' key='` + k + `' page=` + page + `>
                    <img data-src="` + json.img + `" class="lazyload">
                    <div class="title">` + title + `</div>
                    <br>` + (json.online != undefined ? '<div class="chip">' + formatFileSize(json.online.size) + `</div>` : '') + `<div class="chip ` + getColorByLang(json.lang) + ` white-text">` + json.lang + `</div>
                    </p></li>`;
            }

            function toItem(dom) {
                $('.search_active').removeClass('search_active');
                var index = dom.attr('key');
                var page = dom.attr('page');
                
                setTimeout(function() {
                  var find;
                    if(g_b_searchInFavorite){
                        // 没有加载favorite界面
                        if (!$('#test2').hasClass('active')) { 
                          // 加载
                          $('.tab a')[1].click()
                        }
                      }else{
                        // 没有加载list界面
                        if (!$('#test1').hasClass('active')) { 
                          // 加载
                          $('.tab a')[0].click()
                        }
                      }
                      if (page != g_page) {
                          loadPage(page);
                      }
                      setTimeout(function(){
                        if(g_b_searchInFavorite){
                            find = $('.card[key=' + index + ']');
                          }else{
                            find = $('tr[key=' + index + ']');
                          }
                        if (find.length > 0) {
                          g_b_searchInFavorite = false;
                           find.addClass('search_active');
                            $(document).scrollTop(find.offset().top - $(this).height() / 2);
                        }
                      }, 500);
                     
                }, 500);
            }
        </script>
    </body>
</html>
